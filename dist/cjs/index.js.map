{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import { AxiosResponse } from \"axios\";\nimport { Response as NodeResponse } from \"node-fetch\";\n\ninterface CrossFetchResponse {\n  _bodyBlob: Blob;\n}\n\nfunction streamIterator<T>(stream): AsyncIterableIterator<T> {\n  const iterator = stream[Symbol.asyncIterator]();\n  return {\n    next(): Promise<IteratorResult<T, boolean>> {\n      return iterator.next();\n    },\n    [Symbol.asyncIterator](): AsyncIterator<T> {\n      return this;\n    },\n  } as AsyncIterableIterator<T>;\n}\n\n/* c8 ignore start */\nfunction readerIterator<T>(reader): AsyncIterableIterator<T> {\n  return {\n    next(): Promise<IteratorResult<T, boolean>> {\n      return reader.read();\n    },\n    [Symbol.asyncIterator](): AsyncIterator<T> {\n      return this;\n    },\n  } as AsyncIterableIterator<T>;\n}\n\nfunction promiseIterator<T>(promise): AsyncIterableIterator<T> {\n  let resolved = false;\n  return {\n    next(): Promise<IteratorResult<T, boolean>> {\n      if (resolved) return Promise.resolve({ value: undefined, done: true });\n      resolved = true;\n      return new Promise(function (resolve, reject) {\n        promise\n          .then(function (value) {\n            resolve({ value, done: false });\n          })\n          .catch(reject);\n      });\n    },\n    [Symbol.asyncIterator](): AsyncIterator<T> {\n      return this;\n    },\n  } as AsyncIterableIterator<T>;\n}\n/* c8 ignore stop */\n\n/**\n * @param response A response. Supports fetch, node-fetch, and cross-fetch\n */\nexport default function responseIterator<T>(response: unknown): AsyncIterableIterator<T> {\n  if (response === undefined) throw new Error(\"Missing response for responseIterator\");\n\n  // determine the body\n  let body: unknown = response;\n  if ((response as NodeResponse).body) body = (response as NodeResponse).body;\n  // node-fetch, browser fetch, undici\n  else if ((response as AxiosResponse).data) body = (response as AxiosResponse).data;\n  // axios\n  /* c8 ignore start */ else if ((response as CrossFetchResponse)._bodyBlob)\n    body = (response as CrossFetchResponse)._bodyBlob; // cross-fetch\n  /* c8 ignore stop */\n\n  // adapt the body\n  if (body[Symbol.asyncIterator]) return streamIterator<T>(body as AsyncIterableIterator<T>);\n  /* c8 ignore start */\n  if ((body as ReadableStream<T>).getReader) return readerIterator<T>((body as ReadableStream<T>).getReader());\n  if ((body as Blob).stream)\n    return readerIterator<T>(((body as Blob).stream() as unknown as ReadableStream<T>).getReader());\n  if ((body as Blob).arrayBuffer) return promiseIterator<T>((body as Blob).arrayBuffer());\n  /* c8 ignore stop */\n\n  throw new Error(\"Unknown body type for responseIterator. Maybe you are not passing a streamable response\");\n}\n"],"names":["streamIterator","stream","iterator","Symbol","asyncIterator","next","readerIterator","reader","read","promiseIterator","promise","resolved","Promise","resolve","value","undefined","done","reject","then","responseIterator","response","Error","body","data","_bodyBlob","getReader","arrayBuffer"],"mappings":";;;;;;;;;;;;;;;;;AAOA,SAASA,cAAT,CAA2BC,MAA3B,EAA6D;AAC3D,MAAMC,QAAQ,GAAGD,MAAM,CAACE,MAAM,CAACC,aAAR,CAAN,EAAjB;AACA;AACEC,IAAAA,IADF,kBAC8C;AAC1C,aAAOH,QAAQ,CAACG,IAAT,EAAP;AACD;AAHH,KAIGF,MAAM,CAACC,aAJV,cAI6C;AACzC,WAAO,IAAP;AACD,GANH;AAQD;AAED;;;AACA,SAASE,cAAT,CAA2BC,MAA3B,EAA6D;AAC3D;AACEF,IAAAA,IADF,kBAC8C;AAC1C,aAAOE,MAAM,CAACC,IAAP,EAAP;AACD;AAHH,KAIGL,MAAM,CAACC,aAJV,cAI6C;AACzC,WAAO,IAAP;AACD,GANH;AAQD;;AAED,SAASK,eAAT,CAA4BC,OAA5B,EAA+D;AAC7D,MAAIC,QAAQ,GAAG,KAAf;AACA;AACEN,IAAAA,IADF,kBAC8C;AAC1C,UAAIM,QAAJ,EAAc,OAAOC,OAAO,CAACC,OAAR,CAAgB;AAAEC,QAAAA,KAAK,EAAEC,SAAT;AAAoBC,QAAAA,IAAI,EAAE;AAA1B,OAAhB,CAAP;AACdL,MAAAA,QAAQ,GAAG,IAAX;AACA,aAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBI,MAAnB,EAA2B;AAC5CP,QAAAA,OAAO,CACJQ,IADH,CACQ,UAAUJ,KAAV,EAAiB;AACrBD,UAAAA,OAAO,CAAC;AAAEC,YAAAA,KAAK,EAALA,KAAF;AAASE,YAAAA,IAAI,EAAE;AAAf,WAAD,CAAP;AACD,SAHH,WAISC,MAJT;AAKD,OANM,CAAP;AAOD;AAXH,KAYGd,MAAM,CAACC,aAZV,cAY6C;AACzC,WAAO,IAAP;AACD,GAdH;AAgBD;AACD;;AAEA;AACA;AACA;;;AACe,SAASe,gBAAT,CAA6BC,QAA7B,EAA0E;AACvF,MAAIA,QAAQ,KAAKL,SAAjB,EAA4B,MAAM,IAAIM,KAAJ,CAAU,uCAAV,CAAN,CAD2D;;AAIvF,MAAIC,IAAa,GAAGF,QAApB;AACA,MAAKA,QAAD,CAA2BE,IAA/B,EAAqCA,IAAI,GAAIF,QAAD,CAA2BE,IAAlC,CAArC;AAAA,OAEK,IAAKF,QAAD,CAA4BG,IAAhC,EAAsCD,IAAI,GAAIF,QAAD,CAA4BG,IAAnC,CAAtC;;AAEL;AAFK,OAEsB,IAAKH,QAAD,CAAiCI,SAArC,EACzBF,IAAI,GAAIF,QAAD,CAAiCI,SAAxC,CAVqF;;AAWvF;AAEA;;AACA,MAAIF,IAAI,CAACnB,MAAM,CAACC,aAAR,CAAR,EAAgC,OAAOJ,cAAc,CAAIsB,IAAJ,CAArB;AAChC;;AACA,MAAKA,IAAD,CAA4BG,SAAhC,EAA2C,OAAOnB,cAAc,CAAKgB,IAAD,CAA4BG,SAA5B,EAAJ,CAArB;AAC3C,MAAKH,IAAD,CAAerB,MAAnB,EACE,OAAOK,cAAc,CAAMgB,IAAD,CAAerB,MAAf,EAAD,CAA0DwB,SAA1D,EAAJ,CAArB;AACF,MAAKH,IAAD,CAAeI,WAAnB,EAAgC,OAAOjB,eAAe,CAAKa,IAAD,CAAeI,WAAf,EAAJ,CAAtB;AAChC;;AAEA,QAAM,IAAIL,KAAJ,CAAU,yFAAV,CAAN;AACD;;;;"}